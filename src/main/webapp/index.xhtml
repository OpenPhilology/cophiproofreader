<?xml version="1.0" encoding="UTF-8"?>
<!--
This file is part of eu.himeros_CoPhiProofReader3_war_1.0-SNAPSHOT

Copyright (C) 2013 federico[DOT]boschetti[DOT]73[AT]gmail[DOT]com

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    <h:head>
        <title>CoPhiProofReader</title>
        <!-- rev 0.2 -->
    </h:head>
    <h:body onload="#{initBean.setRoot('/opt/junk')};#{initBean.setBookFilter('.book')};#{initBean.setPageFilter('.html')};#{initBean.setImageFilter('.png')}">        
        <h:outputStylesheet library="css" name="nlp.css"/>
        <p:layout fullPage="true">
            <p:layoutUnit size="10%" position="north" resizable="true" closable="false" collapsible="true">
                <h:form id="libraryForm" prependId="lf">
                    <p:selectOneMenu value="#{libraryBean.library.currBookReference}">
                        <f:selectItems value="#{libraryBean.library.ocrBooks}" var="ocrBook" itemLabel="#{ocrBook.ocrBookLabel}" itemValue="#{ocrBook.id}"/>
                    </p:selectOneMenu>
                </h:form>
            </p:layoutUnit>
            <p:layoutUnit size="90%" position="center" resizable="true" closable="false" collapsible="true">
                <p:layout fullPage="false">
                    <p:layoutUnit style="text-align: right;" size="10%" position="west" resizable="true" closable="false" collapsible="true">
                        <h:form id="bookForm" prependId="bf">
                            <c:forEach items="#{bookBean.ocrPages}" var="ocrPage">
                                <p:commandLink immediate="false"  update="" onclick="document.getElementById('pageForm').style.display='block';" oncomplete="window.location.reload();"  style="text-decoration: none;"  title="#{ocrPage.ocrPageLabel}" value="#{ocrPage.ocrPageLabel}">
                                    <f:setPropertyActionListener value="#{ocrPage.id}" target="#{bookBean.currPageReference}" />
                                </p:commandLink><h:outputText value="&nbsp;&nbsp;&lt;br/&gt;" escape="false"/>
                               
                            </c:forEach>
                        </h:form>
                    </p:layoutUnit>
                    <p:layoutUnit size="90%" position="center" resizable="true" closable="false" collapsible="true">
                        <p:panel id="pagePanel" rendered="true">
                            <h:form id="pageForm" prependId="pf">
                                <c:forEach items="#{pageBean.page.ocrLines}" var="ocrLine" varStatus="lineStatus">
                                    <h:outputText value="&lt;br/&gt;" escape="false"/>
                                    <h:outputText value="&lt;br/&gt;" escape="false"/>
                                    <p:graphicImage value="#{pageImageBean.image}" height="20">
                                        <f:param name="lineId" value="#{lineStatus.index}"/>
                                        <f:param name="x1" value="#{ocrLine.scan.coords.x1}"/>
                                        <f:param name="y1" value="#{ocrLine.scan.coords.y1}"/>
                                        <f:param name="x2" value="#{ocrLine.scan.coords.x2}"/>
                                        <f:param name="y2" value="#{ocrLine.scan.coords.y2}"/>
                                    </p:graphicImage>
                                    <h:outputText value="&lt;br/&gt;" escape="false"/>


                                    <c:forEach items="#{ocrLine.ocrWords}" var="ocrWord" varStatus="wordStatus">   
                                        <!--<h:outputText value="!{ocrWord.insertion.text}"/>-->
                                        <span onclick="document.getElementsByName('s#{lineStatus.index}_#{wordStatus.index}')[0].style.color='black';"  style="font-family:Helvetica;font-size: medium;color:#{ocrWord.insertion.nlpColor};" name="s#{lineStatus.index}_#{wordStatus.index}">
                                            <p:inplace editor="true">
                                                <p:selectOneMenu editable="true" value="${ocrWord.insertion.text}">
                                                    <f:selectItem itemLabel="#{ocrWord.insertion.text}" itemValue="#{ocrWord.insertion.text}"/>
                                                    <f:selectItems value="#{ocrWord.deletions}" var="del" itemLabel="#{del.text}" itemValue="#{del.text}"/>
                                                </p:selectOneMenu>
                                                <p:ajax event="save" listener="#{pageBean.updateInsertion(ocrWord.insertion.text,lineStatus.index,wordStatus.index)}"/>
                                            </p:inplace><p:spacer width="10px"/>
                                        </span>
                                    </c:forEach>
                                </c:forEach>
                            </h:form>
                        </p:panel>
                    </p:layoutUnit>
                </p:layout>
            </p:layoutUnit>
        </p:layout>
        <f:verbatim>
            <script type="text/javascript">
                <![CDATA[
                function sleep(ms)
                {
                    var dt = new Date();
                    dt.setTime(dt.getTime() + ms);
                    while (new Date().getTime() < dt.getTime());
                }
                ]]>
            </script>
        </f:verbatim>
    </h:body>
</html>
